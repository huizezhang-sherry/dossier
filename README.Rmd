---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# dossier

<!-- badges: start -->
[![R-CMD-check](https://github.com/huizezhang-sherry/dossier/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/huizezhang-sherry/dossier/actions/workflows/R-CMD-check.yaml)
[![Codecov test coverage](https://codecov.io/gh/huizezhang-sherry/dossier/graph/badge.svg)](https://app.codecov.io/gh/huizezhang-sherry/dossier)
<!-- badges: end -->

The `dossier` package provides tools to analyze and compare decisions made in the data analysis across multiple applied studies on the same topic. It helps explore the "garden of forking paths" by highlighting patterns, similarities, and differences in how analyses are conducted.

## Installation

<!-- You can install the released version of dossier from [CRAN](https://CRAN.R-project.org) with: -->

<!-- ``` r -->
<!-- install.packages("dossier") -->
<!-- ``` -->

<!-- And  -->

You can install the development version from [GitHub](https://github.com/) with:

``` r
# install.packages("remotes")
remotes::install_github("huizezhang-sherry/dossier")
```

## Example

This is a basic example which shows you how to solve a common problem:

```{r example, message=FALSE}
library(dossier)
library(dplyr)
library(text)
(raw_df <- readr::read_csv(system.file("papers.csv", package = "dossier")))
```
 
```{r}
# select the variable-type pair to compare papers
count_variable_type(raw_df)
df <- raw_df |> filter_variable_type(n = 6) # first 6 variable-type pairs

# subset to papers with at least 3 decisions
pivot_variable_wider(df) |> summarize_num_decisions_pp()
good_papers <- pivot_variable_wider(df) |> slice_papers(n_count = 3)

# final data frame to compare
paper_df <- pivot_decision_wider(df) |> filter(paper %in% good_papers$paper)
```

```{r}
summarize_decisions_ppp(paper_df)
summarize_decisions_ppp(paper_df) |> dplyr::count(pairs)
```



```{r}
# calculate the text embed
embed_df <- paper_df |> compute_text_embed()
# calculate decision similarity
(distance_decision_df <- calc_decision_similarity(paper_df, embed = embed_df))
# aggregate from decision similarity to paper similarity
(distance_df <- distance_decision_df |> calc_paper_similarity())
# turn into a standard distance matrix
to_dist_mtx(distance_df)
```

## Diagnostics 

```{r}
diag_decision_ppp(distance_decision_df, distance_df)
view_pairs(paper_df, distance_decision_df, "braga", "zanobetti")
```

